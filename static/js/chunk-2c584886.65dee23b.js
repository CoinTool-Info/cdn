(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2c584886"],{"1d3b":function(e,t,n){"use strict";n.r(t);var r=n("c7eb"),a=n("1da1"),s=n("5530"),i=(n("4de4"),n("d3b7"),n("c740"),n("b680"),n("b0c0"),n("2f62")),o=n("404b"),c=n("ed08"),l=n("b893"),d={name:"subscription",computed:Object(s.a)({},Object(i.d)({networkId:function(e){return e.dapp.web3.networkId},myAddress:function(e){return e.dapp.web3.account},initial:function(e){return e.dapp.web3.initial},web3Instance:function(e){return e.dapp.web3.web3Instance},loginFlag:function(e){return e.user.loginFlag},inviteCode:function(e){return e.user.inviteCode}})),watch:{textStatus:function(e){3===e&&this.showConfirm(),4===e&&this.showFailure()}},data:function(){return{decimalsCarry:c.e,downFixed:l.j,hiddenAddress:c.j,subId:null,subName:null,subList:[],selectPayment:"BNB",paymentList:[{icon:"https://bscscan.com/token/images/binance_32.png",tokenSymbol:"BNB"},{icon:"https://ethereum.org/favicon-32x32.png?v=8b512faa8d4a0b019c123a771b6622aa",tokenSymbol:"ETH"},{icon:"https://cn.etherscan.com/token/images/tether_32.png",tokenSymbol:"USDT"},{icon:"https://bscscan.com/token/images/busd_32.png",tokenSymbol:"BUSD"}],dialog:{createOrder:!1},loading:{order:!1,initial:!1,createOrder:!1},lockOrder:{},timer:null,textStatus:0}},methods:{closeCreateOrder:function(){this.dialog.createOrder=!1,this.loading.createOrder=!1,this.textStatus=0,clearInterval(this.timer)},showPayText:function(){switch(this.textStatus){case 0:return"支付";case 1:return"支付中";case 2:return"确认中";case 3:return"购买成功";case 4:return"购买失败"}},payment:function(){var e=this;return Object(a.a)(Object(r.a)().mark((function t(){var n,a,s,i,c,l;return Object(r.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.networkId===e.lockOrder.chainId){t.next=3;break}return e.$message.warning(e.$t("other.networkError")),t.abrupt("return");case 3:return e.loading.createOrder=!0,e.textStatus=1,t.next=7,e.web3Instance.eth.getTransactionCount(e.myAddress);case 7:n=t.sent,a=e.myAddress,s=null,i=null,c="0x","0x000000000000000000000000000000000000bEEF"==e.lockOrder.paymentTokenAddress?(s=e.lockOrder.payer,i=e.lockOrder.sourcePrice):(s=e.lockOrder.paymentTokenAddress,i="0",l=e.web3Instance.eth.abi.encodeFunctionCall({name:"transfer",type:"function",inputs:[{type:"address",name:"recipient"},{type:"uint256",name:"amount"}]},[e.lockOrder.payer,e.lockOrder.sourcePrice]),c=l),e.web3Instance.eth.sendTransaction({from:a,to:s,value:i,data:c,nonce:n}).then((function(t){return Object(o.m)({orderId:e.lockOrder.id,fromAddress:t.from,toAddress:t.to,txHash:t.transactionHash,input:c,value:i,nonce:n})})).then((function(t){t&&(e.loading.createOrder=!0,e.textStatus=2,e.timer=setInterval(e.startGetOrderUpdate,3e3))})).catch((function(t){e.$message.error(t),e.textStatus=0,e.loading.createOrder=!1}));case 14:case"end":return t.stop()}}),t)})))()},startGetOrderUpdate:function(){var e=this;Object(o.f)(this.lockOrder.id).then((function(t){2===t.status&&(e.$message.success(e.$t("other.buySuccess")),e.$store.dispatch("user/getUserBaseInfo"),clearInterval(e.timer),e.textStatus=3,e.loading.createOrder=!1),3===t.status&&(e.$message.error(e.$t("other.buyError")),clearInterval(e.timer),e.textStatus=4,e.loading.createOrder=!1)}))},showFailure:function(){var e=this;return Object(a.a)(Object(r.a)().mark((function t(){return Object(r.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.closeCreateOrder(),t.next=3,e.$confirm(e.$t("other.showFailureMsg"),e.$t("other.showFailureTitle"),{confirmButtonText:e.$t("other.copy"),cancelButtonText:e.$t("other.cancel"),type:"error",center:!0}).then((function(){return!0})).catch((function(){return!1}));case 3:t.sent&&window.open("mailto:tokentool.app@gmail.com");case 5:case"end":return t.stop()}}),t)})))()},showConfirm:function(){var e=this;return Object(a.a)(Object(r.a)().mark((function t(){return Object(r.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.closeCreateOrder(),t.next=3,e.$confirm("恭喜您成功购买【"+e.subName+"】会员，"+e.lockOrder.increaseTime+" Days","购买完成，祝大哥发财！",{confirmButtonText:e.$t("other.liveMember"),cancelButtonText:e.$t("other.cancel"),type:"success",center:!0}).then((function(){return!0})).catch((function(){return!1}));case 3:t.sent&&e.$router.push("/profile");case 5:case"end":return t.stop()}}),t)})))()},buyOrder:function(e){var t=this;if(this.loginFlag){var n=e.paymentList.filter((function(e){return e.chainId===t.networkId&&e.tokenSymbol===t.selectPayment}));if(n&&0!==n.length){this.lockOrder={};var r=n[0];this.dialog.createOrder=!0,this.loading.order=!0,Object(o.j)({inviteCode:this.inviteCode,subscriptionId:e.id,paymentId:r.id}).then((function(e){t.lockOrder=e})).finally((function(){t.loading.order=!1}))}else this.$message.warning(this.$t("other.networkError"))}else this.$store.commit("user/SET_DIALOG_SHOW",!0)},showPrice:function(e,t){var n=this,r=t.findIndex((function(e){return e.tokenSymbol===n.selectPayment})),a=t[r].usdPrice;return 1===a?e:parseFloat(e/a).toFixed(3)},init:function(){var e=this;this.subList=[],this.loading.initial=!0,Object(o.h)(this.subId).then((function(t){e.subName=t.name,e.subList=t.subscriptionList})).finally((function(){e.loading.initial=!1}))}},beforeDestroy:function(){this.timer&&clearInterval(this.timer)},created:function(){this.subId=this.$route.params.id,this.init()}},u=d,m=(n("df7c1"),n("2877")),p=Object(m.a)(u,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"mainBox"},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading.initial,expression:"loading.initial"}],staticClass:"container"},[n("div",{staticClass:"sub-title"},[e._v(e._s(e.subName))]),n("div",{staticClass:"pay-text"},[e._v(e._s(e.$t("other.payMethod")))]),n("el-radio-group",{attrs:{size:"small"},model:{value:e.selectPayment,callback:function(t){e.selectPayment=t},expression:"selectPayment"}},e._l(e.paymentList,(function(t){return n("el-radio-button",{key:t.tokenSymbol,attrs:{label:t.tokenSymbol}},[n("span",{staticClass:"tokenSymbol"},[n("img",{attrs:{src:t.icon}}),e._v(" "+e._s(t.tokenSymbol))])])})),1),n("div",{staticClass:"payBox"},e._l(e.subList,(function(t){return n("div",{staticClass:"sub-pay"},[n("div",{staticClass:"title"},[e._v(e._s(t.remark))]),n("div",{staticClass:"flex"},[n("span",{staticClass:"price"},[e._v(e._s(e.showPrice(t.usdPrice,t.paymentList))+" "+e._s(e.selectPayment))]),n("span",{staticClass:"usdPrice"},[e._v("$"+e._s(t.usdPrice))])]),n("el-button",{staticClass:"btn",attrs:{type:"primary",size:"medium"},on:{click:function(n){return e.buyOrder(t)}}},[n("span",[e._v(e._s(e.$t("other.joinNow")))])])],1)})),0),n("el-dialog",{attrs:{visible:e.dialog.createOrder,"close-on-press-escape":!1,"close-on-click-modal":!1,width:"370px"},on:{"update:visible":function(t){return e.$set(e.dialog,"createOrder",t)},close:function(t){return e.closeCreateOrder()}}},[e.loading.order?n("div",{staticClass:"loadingBox"},[n("div",{staticClass:"loading"},[n("i",{staticClass:"el-icon-loading"})]),n("span",[e._v(e._s(e.$t("other.createOrder")))])]):n("div",{staticClass:"orderBox"},[n("ul",[n("li",[n("span",[e._v("Order ID")]),n("span",[e._v(e._s(e.lockOrder.id))])]),n("li",[n("span",[e._v("Chain ID")]),n("span",[e._v(e._s(56===e.lockOrder.chainId?"BNB Smart Chain":"ETH Mainnet"))])]),n("li",[n("span",[e._v("Payer")]),n("span",[e._v(e._s(e.hiddenAddress(e.lockOrder.payer)))])]),n("li",[n("span",[e._v("Time")]),n("span",[e._v(e._s(e.lockOrder.increaseTime)+" days")])]),n("li",[n("span",[e._v("Token Price")]),n("span",[e._v("$"+e._s(e.downFixed(e.decimalsCarry(e.lockOrder.paymentTokenLockPrice,e.lockOrder.paymentTokenDecimal),2)))])]),n("li",[n("span",[e._v("Total")]),n("span",[e._v("$"+e._s(e.downFixed(e.decimalsCarry(e.lockOrder.sourcePrice,e.lockOrder.paymentTokenDecimal),3))+" "+e._s(e.selectPayment))])])]),n("div",{staticClass:"btn"},[n("el-button",{attrs:{type:"primary",size:"medium",loading:e.loading.createOrder},on:{click:function(t){return e.payment()}}},[e._v(e._s(e.showPayText()))])],1)])])],1)])}),[],!1,null,"2f62a848",null);t.default=p.exports},6162:function(e,t,n){},df7c1:function(e,t,n){"use strict";n("6162")}}]);