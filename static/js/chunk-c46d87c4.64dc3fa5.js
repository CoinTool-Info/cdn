(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-c46d87c4"],{"1d3b":function(e,t,r){"use strict";r.r(t);var n=r("c7eb"),a=r("1da1"),s=r("5530"),i=(r("4de4"),r("c740"),r("14d9"),r("b0c0"),r("b680"),r("d3b7"),r("2f62")),o=r("404b"),c=r("ed08"),d=r("b893"),l={name:"subscription",computed:Object(s.a)({},Object(i.d)({networkId:function(e){return e.dapp.web3.networkId},myAddress:function(e){return e.dapp.web3.account},initial:function(e){return e.dapp.web3.initial},web3Instance:function(e){return e.dapp.web3.web3Instance},loginFlag:function(e){return e.user.loginFlag},inviteCode:function(e){return e.user.inviteCode}})),watch:{textStatus:function(e){3===e&&this.showConfirm(),4===e&&this.showFailure()}},data:function(){return{decimalsCarry:c.e,downFixed:d.l,hiddenAddress:c.l,subId:null,subName:null,subList:[],selectPayment:"BNB",paymentList:[{icon:"https://bscscan.com/token/images/binance_32.png",tokenSymbol:"BNB"},{icon:"https://ethereum.org/favicon-32x32.png?v=8b512faa8d4a0b019c123a771b6622aa",tokenSymbol:"ETH"},{icon:"https://cn.etherscan.com/token/images/tether_32.png",tokenSymbol:"USDT"},{icon:"https://bscscan.com/token/images/busd_32.png",tokenSymbol:"BUSD"}],dialog:{createOrder:!1},loading:{order:!1,initial:!1,createOrder:!1},lockOrder:{},timer:null,textStatus:0}},methods:{closeCreateOrder:function(){this.dialog.createOrder=!1,this.loading.createOrder=!1,this.textStatus=0,clearInterval(this.timer)},showPayText:function(){switch(this.textStatus){case 0:return"支付";case 1:return"支付中";case 2:return"确认中";case 3:return"购买成功";case 4:return"购买失败"}},payment:function(){var e=this;return Object(a.a)(Object(n.a)().mark((function t(){var r,a,s,i,c,d,l,u,m;return Object(n.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.networkId===e.lockOrder.chainId){t.next=3;break}return e.$message.warning(e.$t("other.networkError")),t.abrupt("return");case 3:return e.loading.createOrder=!0,e.textStatus=1,t.next=7,e.web3Instance.eth.getTransactionCount(e.myAddress);case 7:return r=t.sent,a=e.myAddress,s=null,i=null,c="0x","0x000000000000000000000000000000000000bEEF"==e.lockOrder.paymentTokenAddress?(s=e.lockOrder.payer,i=e.lockOrder.sourcePrice):(s=e.lockOrder.paymentTokenAddress,i="0",d=e.web3Instance.eth.abi.encodeFunctionCall({name:"transfer",type:"function",inputs:[{type:"address",name:"recipient"},{type:"uint256",name:"amount"}]},[e.lockOrder.payer,e.lockOrder.sourcePrice]),c=d),t.next=15,e.web3Instance.eth.getGasPrice();case 15:return l=t.sent,t.next=18,e.web3Instance.eth.sendTransaction({from:a,to:s,value:i,data:c,nonce:r,gasPrice:l}).then((function(t){return Object(o.o)({orderId:e.lockOrder.id,fromAddress:t.from,toAddress:t.to,txHash:t.transactionHash,input:c,value:i,nonce:r}),t})).catch((function(t){e.$message.error(t),e.textStatus=0,e.loading.createOrder=!1}));case 18:if(!(u=t.sent)){t.next=36;break}e.loading.createOrder=!0,e.textStatus=2,e.timer=setInterval(e.startGetOrderUpdate,3e3),m=0;case 24:if(!(m<3)){t.next=36;break}return t.prev=25,t.next=28,Object(o.o)({orderId:e.lockOrder.id,fromAddress:a,toAddress:s,txHash:u.transactionHash,input:c,value:i,nonce:r});case 28:t.next=33;break;case 30:t.prev=30,t.t0=t.catch(25);case 33:m++,t.next=24;break;case 36:case"end":return t.stop()}}),t,null,[[25,30]])})))()},startGetOrderUpdate:function(){var e=this;Object(o.g)(this.lockOrder.id).then((function(t){2===t.status&&(e.$message.success(e.$t("other.buySuccess")),e.$store.dispatch("user/getUserBaseInfo"),clearInterval(e.timer),e.textStatus=3,e.loading.createOrder=!1),3===t.status&&(e.$message.error(e.$t("other.buyError")),clearInterval(e.timer),e.textStatus=4,e.loading.createOrder=!1)}))},showFailure:function(){var e=this;return Object(a.a)(Object(n.a)().mark((function t(){return Object(n.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.closeCreateOrder(),t.next=3,e.$confirm(e.$t("other.showFailureMsg"),e.$t("other.showFailureTitle"),{confirmButtonText:e.$t("other.copy"),cancelButtonText:e.$t("other.cancel"),type:"error",center:!0}).then((function(){return!0})).catch((function(){return!1}));case 3:t.sent&&window.open("mailto:tokentool.app@gmail.com");case 5:case"end":return t.stop()}}),t)})))()},showConfirm:function(){var e=this;return Object(a.a)(Object(n.a)().mark((function t(){return Object(n.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.closeCreateOrder(),t.next=3,e.$confirm("恭喜您成功购买【"+e.subName+"】会员，"+e.lockOrder.increaseTime+" Days","购买完成，祝大哥发财！",{confirmButtonText:e.$t("other.liveMember"),cancelButtonText:e.$t("other.cancel"),type:"success",center:!0}).then((function(){return!0})).catch((function(){return!1}));case 3:t.sent&&e.$router.push("/profile");case 5:case"end":return t.stop()}}),t)})))()},buyOrder:function(e){var t=this;if(this.loginFlag){var r=e.paymentList.filter((function(e){return e.chainId===t.networkId&&e.tokenSymbol===t.selectPayment}));if(r&&0!==r.length){this.lockOrder={};var n=r[0];this.dialog.createOrder=!0,this.loading.order=!0,Object(o.l)({inviteCode:this.inviteCode,subscriptionId:e.id,paymentId:n.id}).then((function(e){t.lockOrder=e})).finally((function(){t.loading.order=!1}))}else this.$message.warning(this.$t("other.networkError"))}else this.$store.commit("user/SET_DIALOG_SHOW",!0)},showPrice:function(e,t){var r=this,n=t.findIndex((function(e){return e.tokenSymbol===r.selectPayment})),a=t[n].usdPrice;return 1===a?e:parseFloat(e/a).toFixed(3)},init:function(){var e=this;this.subList=[],this.loading.initial=!0,Object(o.i)(this.subId).then((function(t){e.subName=t.name,e.subList=t.subscriptionList})).finally((function(){e.loading.initial=!1}))}},beforeDestroy:function(){this.timer&&clearInterval(this.timer)},created:function(){this.subId=this.$route.params.id,this.init()}},u=l,m=(r("1d73"),r("2877")),p=Object(m.a)(u,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"mainBox"},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading.initial,expression:"loading.initial"}],staticClass:"container"},[t("div",{staticClass:"sub-title"},[e._v(e._s(e.subName))]),t("div",{staticClass:"pay-text"},[e._v(e._s(e.$t("other.payMethod")))]),t("el-radio-group",{attrs:{size:"small"},model:{value:e.selectPayment,callback:function(t){e.selectPayment=t},expression:"selectPayment"}},e._l(e.paymentList,(function(r){return t("el-radio-button",{key:r.tokenSymbol,attrs:{label:r.tokenSymbol}},[t("span",{staticClass:"tokenSymbol"},[t("img",{attrs:{src:r.icon}}),e._v(" "+e._s(r.tokenSymbol))])])})),1),t("div",{staticClass:"payBox"},e._l(e.subList,(function(r){return t("div",{staticClass:"sub-pay"},[t("div",{staticClass:"title"},[e._v(e._s(r.remark))]),t("div",{staticClass:"flex"},[t("span",{staticClass:"price"},[e._v(e._s(e.showPrice(r.usdPrice,r.paymentList))+" "+e._s(e.selectPayment))]),t("span",{staticClass:"usdPrice"},[e._v("$"+e._s(r.usdPrice))])]),t("el-button",{staticClass:"btn",attrs:{type:"primary",size:"medium"},on:{click:function(t){return e.buyOrder(r)}}},[t("span",[e._v(e._s(e.$t("other.joinNow")))])])],1)})),0),t("el-dialog",{attrs:{visible:e.dialog.createOrder,"close-on-press-escape":!1,"close-on-click-modal":!1,width:"370px"},on:{"update:visible":function(t){return e.$set(e.dialog,"createOrder",t)},close:function(t){return e.closeCreateOrder()}}},[e.loading.order?t("div",{staticClass:"loadingBox"},[t("div",{staticClass:"loading"},[t("i",{staticClass:"el-icon-loading"})]),t("span",[e._v(e._s(e.$t("other.createOrder")))])]):t("div",{staticClass:"orderBox"},[t("ul",[t("li",[t("span",[e._v("Order ID")]),t("span",[e._v(e._s(e.lockOrder.id))])]),t("li",[t("span",[e._v("Chain ID")]),t("span",[e._v(e._s(56===e.lockOrder.chainId?"BNB Smart Chain":"ETH Mainnet"))])]),t("li",[t("span",[e._v("Payer")]),t("span",[e._v(e._s(e.hiddenAddress(e.lockOrder.payer)))])]),t("li",[t("span",[e._v("Time")]),t("span",[e._v(e._s(e.lockOrder.increaseTime)+" days")])]),t("li",[t("span",[e._v("Token Price")]),t("span",[e._v("$"+e._s(e.downFixed(e.decimalsCarry(e.lockOrder.paymentTokenLockPrice,e.lockOrder.paymentTokenDecimal),2)))])]),t("li",[t("span",[e._v("Total")]),t("span",[e._v("$"+e._s(e.downFixed(e.decimalsCarry(e.lockOrder.sourcePrice,e.lockOrder.paymentTokenDecimal),3))+" "+e._s(e.selectPayment))])])]),t("div",{staticClass:"btn"},[t("el-button",{attrs:{type:"primary",size:"medium",loading:e.loading.createOrder},on:{click:function(t){return e.payment()}}},[e._v(e._s(e.showPayText()))])],1)])])],1)])}),[],!1,null,"0256d948",null);t.default=p.exports},"1d73":function(e,t,r){"use strict";r("bd48")},bd48:function(e,t,r){}}]);